$(function(){ImageMapGenerator.init();$(".colorSelector").simpleColor({cellWidth:9,cellHeight:9,border:"1px solid #333333",buttonClass:"button",displayColorCode:!0})});
var ImageMapGenerator={},ImageMapGenerator={createCanvas:function(d,e){ImageMapGenerator.canvasContainer.append('<canvas id="canvas" width="'+d.width+'" height="'+d.height+'"></canvas>');ImageMapGenerator.mapGenerator(e);$("body").addClass("imageLoaded")},preloadImg:function(d){var e=new Image;e.onload=function(){$(this).appendTo(ImageMapGenerator.canvasContainer);ImageMapGenerator.imageHolder.hide();ImageMapGenerator.createCanvas({width:$(this).width(),height:$(this).height()},e)};e.src=d;e.id="image"},
imageDragDrop:function(){var d=ImageMapGenerator.imageHolder,e=function(b){b.stopPropagation();b.preventDefault()};d[0].addEventListener("dragenter",e,!1);d[0].addEventListener("dragexit",e,!1);d[0].addEventListener("dragover",e,!1);d[0].addEventListener("drop",function(b){b.stopPropagation();b.preventDefault();var b=b.dataTransfer.files[0],d=new FileReader;d.onloadend=function(b){ImageMapGenerator.preloadImg(b.target.result)};b&&d.readAsDataURL(b)},!1)},mapGenerator:function(){var d=document.getElementById("canvas"),
e=$(d),b=d.getContext("2d"),m,n;$(".enableButton");var X=$(".closePathButton"),Y=$(".generateButton"),Z=$(".undoButton"),o=$("#mapHtml"),G=$(".infoFields"),i=$("#href"),p=$("#title"),w=$(".saveInfo"),H=$(".notification"),x=!1,y={},c=[],f=[],I=$("#opacity"),aa=I.val(),J=$("#strokeCol"),K=$("#fillCol"),z=J.val(),L=K.val(),k=0,A,B,g=$("#fakeCanvas"),M=$("#image"),N=$("#imageMap"),C=$("#autoNum"),O=$("#autoPrefix"),q=!1,P,Q,R,r=[],S=function(){2<f.length&&(y.points=f,c.push(y),y={},k=0,f=[],s(c))},s=
function(a,l){l||b.clearRect(0,0,d.width,d.height);b.fillStyle=L;for(var c=0,ba=a.length;c<ba;c++){var f=a[c],h=0,e=f.points,g=e.length;f.lineWidth&&(b.lineWidth=f.lineWidth);b.beginPath();for(b.moveTo(e[h].x,e[h].y);h<g;h++)b.lineTo(e[h].x,e[h].y);b.closePath();b.stroke();b.fill();b.lineWidth=1}},T=function(a,l,c){k++;b.fillStyle=z;b.beginPath();b.arc(a,l,2,0,2*Math.PI,!0);b.fill();var d;if(d=2<k){if(c=!c)c=f[0].x-a,d=f[0].y-l,4>c&&-4<c&&4>d&&-4<d?(S(),j(),c=!0):c=void 0;d=c}d||(2<=k&&(b.strokeStyle=
z,b.beginPath(),b.moveTo(A,B),b.lineTo(a,l),b.closePath(),b.stroke()),A=a,B=l,f.push({x:a,y:l}))},U=function(){var a;!c.length&&f.length?(f.pop(),t(f)):c.length&&f.length?(f.pop(),t(f),s(c,!0)):c.length&&!f.length&&(a=c.pop(),t(a.points),c.length?s(c,!0):f=a.points);j()},t=function(a){var c=0,e=a.length;b.clearRect(0,0,d.width,d.height);k=0;if(0!==e){A=a[0].x;B=a[0].y;for(f=[];c<e;c++)T(a[c].x,a[c].y,!0)}},u=function(){o.fadeIn("slow").val(V()).focus();o[0].select()},V=function(){for(var a="",b=C.is(":checked"),
d="#"+O.val(),e=0,f=c.length;e<f;e++){b&&(c[e].href=d+"-"+(e+1));var h,g=c[e];h=0;for(var i=g.points,k=i.length,j=[],m=g.href?'href="'+g.href+'" ':'href="#" ',g=g.title?'title="'+g.title+'" ':'title=""';h<k;h++)j.push(i[h].x),j.push(i[h].y);h='<area shape="poly" coords="'+j.join(",")+'" '+m+g+' alt="" >';a+="\t"+h+"\n"}return'<map name="imageMap">\n'+a+"</map>"},D=function(){C.is(":checked")||G.fadeIn(200)},v=function(a){var b=$.trim(i.val()),d=$.trim(p.val()),a=a?w.data("current"):c.length-1;c[a].href=
b;c[a].title=d;H.show();setTimeout(function(){H.hide()},450)},j=function(){var a,c=$("#map");a=V();N.css({width:M.width(),height:M.height()});N.attr("usemap","#imageMap");c.length?(c.replaceWith($(a).attr("id","map")),g.show()):(c=$(a).attr("id","map"),g.append(c).show())},E=function(){m=e.offset().left;n=e.offset().top},W=function(){f.length&&t(f);c.length&&s(c)};E();o.val("");j();ImageMapGenerator.canvasContainer.on("mousedown",function(a){a.preventDefault();E();T(a.pageX-m,a.pageY-n)});X.click(function(){f.length&&
(S(),D(),i.val(""),p.val(""),j());return!1});Y.click(function(){u();$(".helpText").slideDown("slow");return!1});w.click(function(){x?v(!0):v();u();return!1});g.on("mousedown","area",function(a){var b=$(this).index();i.val(c[b].href);p.val(c[b].title);w.data("current",b);D();q=x=!0;P=a.pageX-m;Q=a.pageY-n;R=b;r=c[b].points;for(var a=0,d=c.length;a<d;a++)delete c[a].lineWidth;c[b].lineWidth=3;g.addClass("moving");W();return!1});g.on("mousemove",function(a){if(q){var b=R,d=a.pageY-n,e=[],f=0,g=r.length;
diffX=a.pageX-m-P;for(diffY=d-Q;f<g;f++)e[f]={},e[f].x=r[f].x+diffX,e[f].y=r[f].y+diffY;c[b].points=e;W()}return!1});g.on("mouseup",function(){q&&(q=!1,j(),o.is(":visible")&&u());i.focus();g.removeClass("moving");return!1});i.add(p).add(autoPrefix).on("keyup",function(a){"13"==a.which&&(x?v(!0):v(),u())});J.change(function(){z=$(this).val()});K.change(function(){L=$(this).val()});I.change(function(){b.globalAlpha=$(this).val()});Z.click(function(){U();return!1});$(window).on("resize",function(){E()});
C.on("change",function(){$(this).is(":checked")?(O.removeAttr("readonly").focus(),G.fadeOut(200)):D()});b.globalAlpha=aa;var F=!1;$(document).on("keydown",function(a){"17"==a.which?F=!0:F&&"90"==a.which?U():F=!1})},init:function(){ImageMapGenerator.canvasContainer=$("#canvasContainer");ImageMapGenerator.imageHolder=$("#imageZone");ImageMapGenerator.imageDragDrop()}};
(function(c){c.fn.simpleColor=function(b){var d="990033 ff3366 cc0033 ff0033 ff9999 cc3366 ffccff cc6699 993366 660033 cc3399 ff99cc ff66cc ff99ff ff6699 cc0066 ff0066 ff3399 ff0099 ff33cc ff00cc ff66ff ff33ff ff00ff cc0099 990066 cc66cc cc33cc cc99ff cc66ff cc33ff 993399 cc00cc cc00ff 9900cc 990099 cc99cc 996699 663366 660099 9933cc 660066 9900ff 9933ff 9966cc 330033 663399 6633cc 6600cc 9966ff 330066 6600ff 6633ff ccccff 9999ff 9999cc 6666cc 6666ff 666699 333366 333399 330099 3300cc 3300ff 3333ff 3333cc 0066ff 0033ff 3366ff 3366cc 000066 000033 0000ff 000099 0033cc 0000cc 336699 0066cc 99ccff 6699ff 003366 6699cc 006699 3399cc 0099cc 66ccff 3399ff 003399 0099ff 33ccff 00ccff 99ffff 66ffff 33ffff 00ffff 00cccc 009999 669999 99cccc ccffff 33cccc 66cccc 339999 336666 006666 003333 00ffcc 33ffcc 33cc99 00cc99 66ffcc 99ffcc 00ff99 339966 006633 336633 669966 66cc66 99ff99 66ff66 339933 99cc99 66ff99 33ff99 33cc66 00cc66 66cc99 009966 009933 33ff66 00ff66 ccffcc ccff99 99ff66 99ff33 00ff33 33ff33 00cc33 33cc33 66ff33 00ff00 66cc33 006600 003300 009900 33ff00 66ff00 99ff00 66cc00 00cc00 33cc00 339900 99cc66 669933 99cc33 336600 669900 99cc00 ccff66 ccff33 ccff00 999900 cccc00 cccc33 333300 666600 999933 cccc66 666633 999966 cccc99 ffffcc ffff99 ffff66 ffff33 ffff00 ffcc00 ffcc66 ffcc33 cc9933 996600 cc9900 ff9900 cc6600 993300 cc6633 663300 ff9966 ff6633 ff9933 ff6600 cc3300 996633 330000 663333 996666 cc9999 993333 cc6666 ffcccc ff3333 cc3333 ff6666 660000 990000 cc0000 ff0000 ff3300 cc9966 ffcc99 ffffff cccccc 999999 666666 333333 000000 000000 000000 000000 000000 000000 000000 000000 000000".split(" "),b=
c.extend({defaultColor:this.attr("defaultColor")||"#FFF",border:this.attr("border")||"1px solid #000",cellWidth:this.attr("cellWidth")||10,cellHeight:this.attr("cellHeight")||10,cellMargin:this.attr("cellMargin")||1,boxWidth:this.attr("boxWidth")||"115px",boxHeight:this.attr("boxHeight")||"20px",columns:this.attr("columns")||16,insert:this.attr("insert")||"after",buttonClass:this.attr("buttonClass")||"",colors:this.attr("colors")||d,displayColorCode:this.attr("displayColorCode")||!1,colorCodeAlign:this.attr("colorCodeAlign")||
"center",colorCodeColor:this.attr("colorCodeColor")||"#FFF"},b||{});this.hide();b.totalWidth=b.columns*(b.cellWidth+2*b.cellMargin);c.browser.msie&&(b.totalWidth+=2);b.totalHeight=Math.ceil(b.colors.length/b.columns)*(b.cellHeight+2*b.cellMargin);c.simpleColorOptions=b;this.each(function(){var a=c.simpleColorOptions,b=c("<div class='simpleColorContainer' />"),d=this.value&&this.value!=""?this.value:a.defaultColor,g=c("<div class='simpleColorDisplay' />");g.css("backgroundColor",d);g.css("border",
a.border);g.css("width",a.boxWidth);g.css("height",a.boxHeight);g.css("cursor","pointer");b.append(g);if(a.displayColorCode){g.text(this.value);g.css("color",a.colorCodeColor);g.css("textAlign",a.colorCodeAlign)}var k=c("<input type='button' value='Select' class='simpleColorSelectButton "+a.buttonClass+"'>");b.append(k);var l=c("<input type='button' value='Cancel' class='simpleColorCancelButton "+a.buttonClass+"'>");b.append(l);l.hide();var d=function(b){b.data.select_button.hide();b.data.cancel_button.show();
if(b.data.container.chooser)b.data.container.chooser.show();else{var d=c("<div class='simpleColorChooser'/>");d.css("border",a.border);d.css("margin","0px");d.css("margin-top","3px");d.css("width",a.totalWidth+"px");d.css("height",a.totalHeight+"px");b.data.container.chooser=d;b.data.container.append(d);for(var j=0;j<a.colors.length;j++){var h=c("<div class='simpleColorCell' id='"+a.colors[j]+"'/>");h.css("width",a.cellWidth+"px");h.css("height",a.cellHeight+"px");h.css("margin",a.cellMargin+"px");
h.css("cursor","pointer");h.css("lineHeight",a.cellHeight+"px");h.css("fontSize","1px");h.css("float","left");h.css("backgroundColor","#"+a.colors[j]);d.append(h);h.bind("click",{input:b.data.input,chooser:d,select_button:k,cancel_button:l,display_box:g},function(b){b.data.input.value="#"+this.id;c(b.data.input).change();b.data.display_box.css("backgroundColor","#"+this.id);b.data.chooser.hide();b.data.cancel_button.hide();b.data.display_box.show();b.data.select_button.show();a.displayColorCode&&
b.data.display_box.text("#"+this.id)})}}},m={container:b,input:this,cancel_button:l,display_box:g,select_button:k};k.bind("click",m,d);g.bind("click",m,d);l.bind("click",{container:b,select_button:k,display_box:g},function(a){c(this).hide();a.data.container.find(".simpleColorChooser").hide();a.data.display_box.show();a.data.select_button.show()});c(this).after(b)});return this};c.fn.closeSelector=function(){this.each(function(){var b=c(this).parent().find("div.simpleColorContainer");b.find(".simpleColorCancelButton").hide();
b.find(".simpleColorChooser").hide();b.find(".simpleColorDisplay").show();b.find(".simpleColorSelectButton").show()});return this}})(jQuery);